\documentclass{article}


%% Bring the margins down to 1 inch, like the old ``fullpage'' package.
\usepackage[margin=1.0in]{geometry}

\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}


%% Gives the equivalent of one-and-a-half line spacing.
\linespread{1.3}

\begin{document}

\section{Overview of Shanes's original data}

Our earlier work determined that analyses at the phylum-level did not
explain nearly as much of the variability as did models built on
family-level and order-level taxa.  So, we focused on the family and
order levels.  These taxa were obtained from 6 cadavers on 16 different
days.  However, taxa counts are not available for\\
- subject A1 on days 7 and 9\\
- subject A4 on day 7


Since our last meeting, I realized that the data collected from
subject A3 on day 40 (degree day 1130) appears to be defective.  The
total number of taxa (including unclassified taxa) counted for this
cadaver and day was 54.  This is several orders of magnitude less than
the counts for the other cadavers and days, which ranged from 18050 to
93665 (both orders and families).  For this reason, the taxa from
subject A3 on day 40 were omitted from all the analyses.  The omission
of the A3, day 40 data does not affect the analyses which only
consider the first two weeks or data.

For the analyses which considered all time steps, we have 92
observations (16 days $\times$ 6 cadavers, minus the 4 missing
cadaver-day combinations mentioned in the previous paragraphs).  For
the analyses considering the first 15 days (approximately two weeks),
we have 57 observations (10 days $\times$ 6 cadavers, minus the 3
missing cadaver-day combinations occurring during this period).


\section{Cross-validation procedures}

I had some concerns about how well our model would perform in
prediction mode.  We have only 6 cadavers, and we only have
observations at certain time steps.  I'm continuing to use
cross-validation, but I've reduced the training set to 80\% of the
data, reserving 20\% to use as a test set.  (Previously, the split was
90\% and 10\%.)  When using all the data, this means training on a set
of 74 observations, and testing on a size of 18.  When using just the
first 15 days of data, this means training on a set of 46
observations, and testing on a size of 11.  For each model that I fit,
I did 1000 cross-validation runs.  For each of these runs, we randomly
select which 20\% of the observations will be left out of the random
forest algorithm and used to test the model.  The change from 90\% to
80\% made very little difference in the choice of models, which
relieved some of my concern.

Since our last meeting, I figured out how to parallelize some of the
computational work, which allowed me to use some additional
cross-validation runs and to try additional models, compared to what I
had done previously.



\section{All time steps}

In this section, we utilize data collected on all available days.  The
number of days post mortem, along with the corresponding accumulated
degree days, are shown below.

\begin{center}
\begin{tabular}{r|rrrrrrrrrrrrrrrr}
  Day & 0 & 1 & 2 & 3 & 5 & 7 & 9 & 11 & 13 & 15 & 26 & 33 & 40 & 47 & 54 & 61\\
  Degree day & 0 & 27 & 57 & 87 & 149 & 209 & 267 & 326 & 390 & 448 & 734 & 930 & 1130 & 1326 & 1516 & 1703
\end{tabular}
\end{center}



\subsection{Results for family-level taxa}

In our original analysis, we excluded from the model any taxa which
made up less than 1\% of the observed taxa for all cadavers and all
days.  That is, in order to be included, a particular family-level
taxa had to make up at least 1\% of the counts on just one day for
just one individual.  This has the advantage of being an easy cutoff
to implement and to explain.  However, this means that a taxa can be
included based on one unusual observation, even if this taxa is rarely
observed in the vast majority of cases.

To address these concerns, I also ran the analyses with a stricter
cutoff criterion.  Now, in order to be considered in the random forest
model, a taxa must make up more at least 1\% of the counts for at
least two separate cadavers.  These exceedances can happen on the same
day or on different days.  This addresses the concern that one
particularly unusual cadaver can cause taxa to be considered in the
model which are not generally present on other cadavers.  It also
makes explaining the model a bit easier, because there are fewer taxa
to consider and outlying taxa are less likely to affect the fit.

To illustrate the differences, consider the analysis using
family-level taxa for all time steps.  Using the original cutoff
criterion, the model considers 49 possible family-level taxa.  The top
ten most influential taxa identified by the resulting model are shown
in Figure \ref{fig:infl_family_taxa_orig_crit}.  Their influence on the
model is determined by how much the node impurity (i.e., the
variability in the ``leaves'' of the decision tree) is reduced by
including these particular family-level taxa in the random forest
model.  That is, a more influential taxa is associated with a large
decrease in this variability.

\begin{figure}
  \centering
  \includegraphics{../../only_families/all_time_steps/cutoff_1perc/orig_units_all_data_families_barchart}
  \caption{Ten most influential family-level taxa, modeled using a weak inclusion criterion}
  \label{fig:infl_family_taxa_orig_crit}
\end{figure}


When using the original cutoff, the algorithm picks the Listeriaceae
family as an important predictor.  However, the the Listeriaceae
family exceeds 1\% of the total counts for only one day and one
individual.  Figure \ref{fig:scatter_family_taxa} shows some of the
influential families by degree day.  Note the varying scales on the
vertical axes.  We see that the Listeriaceae family only exceeds 1\%
of the total counts on one degree day (1516) for one subject.  So, my
concern is that Listeriaceae may not be present on future observed
cadavers, or, because it is at such low levels, it may not always be
easily measured.

\begin{figure}
  \centering
  \includegraphics{../../only_families/all_time_steps/influential_family_taxa_panel}
  \caption{Some of the influential family-level taxa, by degree day}
  \label{fig:scatter_family_taxa}
\end{figure}

Figure \ref{fig:infl_family_taxa_stric_crit} shows the same type of
plot, but for the random forest model developed using the stricter
criterion.  Again, this criterion only allows taxa to be included if
the taxa makes up at least 1\% of the total counts for at least two
cadavers (can be on same or different days).  Therefore, this stricter
cutoff excludes Listeriaceae, and allows fewer (39) family-level taxa
to be included in the model.  Even so, the statistics presented in
Table \ref{tbl:family_all_data_model_stats} indicates that the
explanatory value of this model is almost as strong.

\begin{figure}
  \centering
  \includegraphics{../../only_families/all_time_steps/hit_1perc_twice/orig_units_all_data_families_barchart}
  \caption{Ten most influential family-level taxa, modeled using a stricter inclusion criterion}
  \label{fig:infl_family_taxa_stric_crit}
\end{figure}


\begin{table}
  \centering
\caption{\label{tbl:family_all_data_model_stats}Model statistics using family-level taxa}
\begin{tabular}{llll}
Inclusion cutoff & Units  & RMSE & Explained variation\\ \hline
1\% at least once (weaker)  & Orig.~units & 198.58 & 87.21\%\\
1\% at least twice (stricter) & Orig.~units & 207.18 & 86.08\% %%\\
%% 1\% at least once  & Sqrt.~units & 4.18 & 88.70\%\\
%% Didn't do the sqrt runs with the stricter cutoff.
\end{tabular}
\end{table}


\subsection{Results for order-level taxa}

For the order-level taxa, I also ran the analysis both ways, with the
stricter inclusion criterion (requiring 1\% for at least two cadavers)
and the weaker, original one.  Again, the model performance is similar
for both, so I think we should go with the stricter cutoff.  With the
stricter cutoff, the model considers 15 order-level taxa, versus 20
taxa with the original criterion.  The relevant performance statistics
are given in Table \ref{tbl:order_all_data_model_stats}.

\begin{table}
  \centering
  \caption{\label{tbl:order_all_data_model_stats}Model statistics using order-level taxa}
\begin{tabular}{llll}
Inclusion cutoff & Units  & RMSE & Explained variation\\ \hline
1\% at least once (weaker)  & Orig.~units & 230.19 & 82.81\%\\
1\% at least twice (stricter) & Orig.~units & 230.65 & 82.74\%
%% 1\% at least once  & Sqrt.~units &   4.38 & 87.62\%\\
%% Didn't do the sqrt runs with the stricter cutoff.
\end{tabular}
\end{table}

Figure \ref{fig:infl_order_taxa_stric_crit} shows the ten orders found
to be most influential in building the random forest model using the
stricter inclusion criterion.  These are similar to those found
previously, using the weaker inclusion criterion, with the one
noticeable difference being the elimination of the Bifidobacteriales
order.  This order exceeded 1\% of the total counts for only one
cadaver, so it could not be considered under the stricter inclusion
criterion.  Figure \ref{fig:scatter_order_taxa} shows the fraction of
counts associated with the six order taxa that were most influential
in the order-level random forest model.  Again, note the varying
scales of the y-axes across the panels.

\begin{figure}
  \centering
  \includegraphics{../../only_orders/all_time_steps/hit_1perc_twice/orig_units_all_data_orders_barchart}
  \caption{Ten most influential order-level taxa, modeled using a stricter inclusion criterion}
  \label{fig:infl_order_taxa_stric_crit}
\end{figure}


\begin{figure}
  \centering
  \includegraphics{../../only_orders/all_time_steps/influential_order_taxa_panel}
  \caption{Some of the influential order-level taxa, by degree day}
  \label{fig:scatter_order_taxa}
\end{figure}



\section{Models using only the first 15 days of data}

\subsection{Results for family-level taxa}

Table \ref{tbl:family_first_15days_model_stats} shows the model
performance statistics for the model using just the first 15 days of
family-level taxa.  Whether we use the weaker or stronger inclusion
criteria, model performance is much the same, so we go with the
stricter criterion for each of interpretation and implementation.  For
the first 15 days of data, we consider 35 possible family-level taxa.
As we might expect, the influential taxa for this early period are
different than those for the full time period.  The top 10 such taxa
are shown in Figure
\ref{fig:infl_family_taxa_first_15days_stric_crit}.  Scatterplots of
six of these taxa are found in Figure
\ref{fig:scatter_family_taxa_first_15days}.  Again, note the
difference in scaling of the y-axis among the various panels.

\begin{table}
  \centering
  \caption{\label{tbl:family_first_15days_model_stats}Model statistics using family-level taxa for the first 15 days}
\begin{tabular}{llll}
Inclusion cutoff & Units  & RMSE & Explained variation\\ \hline
1\% at least once (weaker) & Orig.~units & 64.98 & 81.99\%\\
1\% at least twice (stricter) & Orig.~units & 64.25 & 82.39\%
%% 1\% at least once  & Sqrt.~units & 2.31 & 87.87\%\\
%% 1\% at least twice & Sqrt.~units & 2.28 & 88.20\%
\end{tabular}
\end{table}

\begin{figure}
  \centering
  \includegraphics{../../only_families/first_two_weeks/hit_1perc_twice/orig_units_first_two_weeks_families_barchart}
  \caption{Ten most influential family-level taxa in the first 15 days, modeled using a stricter inclusion criterion}
  \label{fig:infl_family_taxa_first_15days_stric_crit}
\end{figure}

\begin{figure}
  \centering
  \includegraphics{../../only_families/first_two_weeks/influential_family_taxa_panel_first_two_weeks}
  \caption{Some of the influential family-level taxa, for the first 15 days}
  \label{fig:scatter_family_taxa_first_15days}
\end{figure}



\subsection{Results for order-level taxa}

Looking at the model for the first 15 days, using the order-level
taxa, the models with the stricter and weaker inclusion cutoffs are
again very similar.  The model performance statistics are shown in the
Table \ref{tbl:order_first_15days_model_stats}.  We stick with the
stricter inclusion criterion, which utilizes 14 orders in the random
forest model.  Figure
\ref{fig:infl_order_taxa_first_15days_stric_crit} shows the 10 most
influential order-level taxa in the model, and Figure
\ref{fig:scatter_order_taxa_first_15days} provides a sense of how the
fractions attributable to six of these taxa are changing over the
first 15 days.

\begin{table}
  \centering
  \caption{\label{tbl:order_first_15days_model_stats}Model statistics using order-level taxa for the first 15 days}
\begin{tabular}{llll}
Inclusion cutoff & Units  & RMSE & Explained variation\\ \hline
1\% at least once (weaker) & Orig.~units & 53.93 & 87.59\%\\
1\% at least twice (stricter) & Orig.~units & 54.68 & 87.25\%
%% 1\% at least once  & Sqrt.~units & 2.01 & 90.81\%
%% 1\% at least twice & Sqrt.~units & 2.02 & 90.68\%
\end{tabular}
\end{table}

\begin{figure}
  \centering
  \includegraphics{../../only_orders/first_two_weeks/hit_1perc_twice/orig_units_first_two_weeks_orders_barchart}
  \caption{Ten most influential order-level taxa in the first 15 days, modeled using a stricter inclusion criterion}
  \label{fig:infl_order_taxa_first_15days_stric_crit}
\end{figure}

\begin{figure}
  \centering
  \includegraphics{../../only_orders/first_two_weeks/influential_order_taxa_panel_first_two_weeks}
  \caption{Some of the influential order-level taxa, for the first 15 days}
  \label{fig:scatter_order_taxa_first_15days}
\end{figure}


\end{document}

